generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Ownership {
  id                 String  @id
  contract_address   String
  user               String
  type               String
  balance            Decimal @db.Decimal(78, 0)
  last_updated       Decimal @db.Decimal(78, 0)
  last_updated_block Decimal @db.Decimal(78, 0)
  product_id         String

  @@map("ownership")
}

model ProductOnchain {
  id                     String  @id
  sequence_id            Decimal @db.Decimal(78, 0)
  contract_address       String
  name                   String
  symbol                 String
  max_supply             Decimal @db.Decimal(78, 0)
  total_supply           Decimal @db.Decimal(78, 0)
  factory_address        String
  created_at             Decimal @db.Decimal(78, 0)
  created_at_block       Decimal @db.Decimal(78, 0)
  created_at_transaction String
  holder_count           Decimal @db.Decimal(78, 0)
  tenor                  Decimal @db.Decimal(78, 0)
  interest_rate_bps      Decimal @db.Decimal(78, 0)
  borrower               String
  remaining_principal    Decimal @db.Decimal(78, 0)
  repayment_count        Decimal @db.Decimal(78, 0)
  status                 String

  @@map("product_onchain")
}

model ProductMetadata {
  id           Int      @id @default(autoincrement())
  description  String?
  loanInterest Decimal? @db.Decimal(5, 2)
  loanAmount   Decimal? @db.Decimal(20, 2)
  creditRate   String?
  categoryId   String?
  loanTenor    Int?

  @@map("product_metadata")
}

model ManagerOnchain {
  id                  String  @id
  sequence_id         Decimal @db.Decimal(78, 0)
  contract_address    String
  name                String
  owner               String
  created_at          Decimal @db.Decimal(78, 0)
  created_at_block    Decimal @db.Decimal(78, 0)
  total_funds_managed Decimal @db.Decimal(78, 0)

  @@map("manager_onchain")
}

model ManagerMetadata {
  id                    Int      @id
  description           String?
  experienceYears       Int?
  maxProfitAPY          Decimal? @db.Decimal(5, 2)
  riskLevel             String?  @db.VarChar(10)
  strategy              String?
  assetsUnderManagement Decimal? @db.Decimal(20, 2)
  totalClients          Int?

  @@map("manager_metadata")
}

model ManagerAllocation {
  id                    String  @id
  manager_address       String
  project_token_address String
  token_balance         Decimal @db.Decimal(78, 0)
  last_updated          Decimal @db.Decimal(78, 0)

  @@map("manager_allocation")
}

model TransactionLogs {
  id               String  @id
  contract_address String
  related_address  String?
  user             String
  type             String
  amount_in        Decimal @db.Decimal(78, 0)
  amount_out       Decimal @db.Decimal(78, 0)
  timestamp        Decimal @db.Decimal(78, 0)
  block_number     Decimal @db.Decimal(78, 0)
  transaction_hash String
  log_index        Decimal @db.Decimal(78, 0)

  @@map("transaction_logs")
}

model RepaymentLogs {
  id                   String  @id
  contract_address     String
  repayment_number     Decimal @db.Decimal(78, 0)
  principal_paid       Decimal @db.Decimal(78, 0)
  interest_paid        Decimal @db.Decimal(78, 0)
  total_distributed    Decimal @db.Decimal(78, 0)
  remaining_principal  Decimal @db.Decimal(78, 0)
  timestamp            Decimal @db.Decimal(78, 0)
  block_number         Decimal @db.Decimal(78, 0)
  transaction_hash     String

  @@map("repayment_logs")
}


model ponder_checkpoint {
  chain_name           String @id
  chain_id             BigInt
  safe_checkpoint      String @db.VarChar(75)
  latest_checkpoint    String @db.VarChar(75)
  finalized_checkpoint String @db.VarChar(75)

  @@map("_ponder_checkpoint")
}

model ponder_meta {
  key   String @id
  value Json

  @@map("_ponder_meta")
}

model reorg__ownership {
  id                 String
  contract_address   String
  user               String
  type               String
  balance            Decimal @db.Decimal(78, 0)
  last_updated       Decimal @db.Decimal(78, 0)
  last_updated_block Decimal @db.Decimal(78, 0)
  product_id         String
  operation_id       Int     @id @default(autoincrement())
  operation          Int
  checkpoint         String  @db.VarChar(75)

  @@index([checkpoint], map: "ownership_checkpoint_index")
  @@map("_reorg__ownership")
}

model reorg__product_onchain {
  id                     String
  sequence_id            Decimal @db.Decimal(78, 0)
  contract_address       String
  name                   String
  symbol                 String
  max_supply             Decimal @db.Decimal(78, 0)
  total_supply           Decimal @db.Decimal(78, 0)
  factory_address        String
  created_at             Decimal @db.Decimal(78, 0)
  created_at_block       Decimal @db.Decimal(78, 0)
  created_at_transaction String
  holder_count           Decimal @db.Decimal(78, 0)
  tenor                  Decimal @db.Decimal(78, 0)
  interest_rate_bps      Decimal @db.Decimal(78, 0)
  borrower               String
  remaining_principal    Decimal @db.Decimal(78, 0)
  repayment_count        Decimal @db.Decimal(78, 0)
  status                 String
  operation_id           Int     @id @default(autoincrement())
  operation              Int
  checkpoint             String  @db.VarChar(75)

  @@index([checkpoint], map: "product_onchain_checkpoint_index")
  @@map("_reorg__product_onchain")
}

model reorg__transaction_logs {
  id               String
  contract_address String
  related_address  String?
  user             String
  type             String
  amount_in        Decimal @db.Decimal(78, 0)
  amount_out       Decimal @db.Decimal(78, 0)
  timestamp        Decimal @db.Decimal(78, 0)
  block_number     Decimal @db.Decimal(78, 0)
  transaction_hash String
  log_index        Decimal @db.Decimal(78, 0)
  operation_id     Int     @id @default(autoincrement())
  operation        Int
  checkpoint       String  @db.VarChar(75)

  @@index([checkpoint], map: "transaction_logs_checkpoint_index")
  @@map("_reorg__transaction_logs")
}

model User {
  id            String  @id @default(uuid())
  email         String  @unique
  password      String
  username      String  @unique
  name          String?
  walletAddress String?

  @@map("users")
}

model Contract {
  id              String    @id @default(uuid())
  contractAddress String    @unique
  maxSupply       Decimal   @db.Decimal(20, 2)
  products        Product[]

  @@map("contracts")
}

model Product {
  id           String   @id @default(uuid())
  productName  String
  categoryId   String
  description  String
  loanInterest Decimal  @db.Decimal(5, 2)
  loanAmount   Decimal  @db.Decimal(20, 2)
  loanTenor    Int
  creditRate   String
  contractId   String
  contract     Contract @relation(fields: [contractId], references: [id])

  @@map("products")
}

model reorg__manager_allocation {
  id                    String
  manager_address       String
  project_token_address String
  token_balance         Decimal @db.Decimal(78, 0)
  last_updated          Decimal @db.Decimal(78, 0)
  operation_id          Int     @id @default(autoincrement())
  operation             Int
  checkpoint            String  @db.VarChar(75)

  @@index([checkpoint], map: "manager_allocation_checkpoint_index")
  @@map("_reorg__manager_allocation")
}

model reorg__manager_onchain {
  id                  String
  sequence_id         Decimal @db.Decimal(78, 0)
  contract_address    String
  name                String
  owner               String
  created_at          Decimal @db.Decimal(78, 0)
  created_at_block    Decimal @db.Decimal(78, 0)
  total_funds_managed Decimal @db.Decimal(78, 0)
  operation_id        Int     @id @default(autoincrement())
  operation           Int
  checkpoint          String  @db.VarChar(75)

  @@index([checkpoint], map: "manager_onchain_checkpoint_index")
  @@map("_reorg__manager_onchain")
}
